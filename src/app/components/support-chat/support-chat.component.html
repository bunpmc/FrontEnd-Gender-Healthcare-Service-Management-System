<!-- support-chat.component.html -->
<div class="ai-bot-container">
  <!-- Chat Panel -->
  <div class="ai-chat-panel" [class.active]="showChatPanel">
    <!-- Chat Header -->
    <div class="ai-chat-header">
      <div class="header-content">
        <div class="ai-avatar">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path
              d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
            />
          </svg>
        </div>
        <div class="header-text">
          <div class="title">AI Assistant</div>
          <div class="status" [class.offline]="!isConnected">
            <span class="status-indicator"></span>
            {{ isConnected ? "Online" : "Reconnecting..." }}
          </div>
        </div>
      </div>

      <div class="header-actions">
        <button
          class="action-btn clear-btn"
          (click)="clearChat()"
          title="Clear chat"
          *ngIf="messages.length > 1"
        >
          <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
            <path
              d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
            />
          </svg>
        </button>

        <button
          class="action-btn close-btn"
          (click)="toggleChat()"
          title="Close chat"
        >
          <svg viewBox="0 0 24 24" width="16" height="16" fill="#000000">
            <path d="M18 6L6 18M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Chat Body -->
    <div class="ai-chat-body" #chatBody>
      <!-- Connection Status -->
      <div class="connection-status" *ngIf="!isConnected">
        <div class="status-message">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
            <path
              d="M12 2L2 7v10c0 5.55 3.84 9.74 9 11 5.16-1.26 9-5.45 9-11V7l-10-5z"
            />
          </svg>
          Connection lost. Trying to reconnect...
        </div>
      </div>

      <!-- Chat Messages -->
      <div class="chat-messages">
        <div
          *ngFor="let msg of messages; trackBy: trackByMessageId"
          [ngClass]="{
            'ai-message': true,
            bot: msg.from === 'bot',
            user: msg.from === 'user'
          }"
          class="message-wrapper"
        >
          <!-- Bot Avatar
          <div class="message-avatar" *ngIf="msg.from === 'bot'">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor">
              <circle cx="12" cy="12" r="3" />
              <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1" />
            </svg>
          </div> -->

          <!-- Message Content -->
          <div class="message-bubble">
            <div class="message-content">
              {{ msg.text }}
            </div>
            <div class="message-time">
              {{ formatTime(msg.timestamp) }}
            </div>
          </div>
        </div>
      </div>

      <!-- Typing Indicator -->
      <div class="typing-indicator" [class.visible]="isTyping">
        <div class="ai-message bot">
          <div class="message-avatar">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor">
              <circle cx="12" cy="12" r="3" />
              <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1" />
            </svg>
          </div>
          <div class="typing-animation">
            <div class="typing-dots">
              <span></span>
              <span></span>
              <span></span>
            </div>
            <div class="typing-text">AI is thinking...</div>
          </div>
        </div>
      </div>

      <!-- Quick Replies -->
      <div class="quick-replies" *ngIf="messages.length === 1 && !isTyping">
        <div class="quick-replies-title">Quick replies:</div>
        <div class="quick-reply-buttons">
          <button
            *ngFor="let reply of quickReplies"
            class="quick-reply-btn"
            (click)="sendQuickReply(reply)"
          >
            {{ reply }}
          </button>
        </div>
      </div>
    </div>

    <!-- Chat Input -->
    <div class="ai-chat-input">
      <div class="input-container" [class.disabled]="!isConnected">
        <textarea
          #messageInput
          [(ngModel)]="message"
          (keydown)="onKeyDown($event)"
          placeholder="Type your message..."
          rows="1"
          [disabled]="!isConnected"
          class="message-textarea"
        ></textarea>

        <button
          class="send-btn"
          (click)="sendMessage()"
          [disabled]="!message.trim() || !isConnected || isTyping"
          [class.sending]="isTyping"
        >
          <svg
            *ngIf="!isTyping"
            viewBox="0 0 24 24"
            width="18"
            height="18"
            fill="currentColor"
          >
            <path d="M2,21L23,12L2,3V10L17,12L2,14V21Z" />
          </svg>

          <div *ngIf="isTyping" class="loading-spinner">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
              <circle cx="12" cy="12" r="3" />
            </svg>
          </div>
        </button>
      </div>

      <div class="input-hint" *ngIf="isConnected">
        Press Enter to send â€¢ Shift + Enter for new line
      </div>
    </div>
  </div>

  <!-- Chat Bot Icon -->
  <div
    class="ai-bot-icon"
    (click)="toggleChat()"
    [class.active]="showChatPanel"
    [class.has-unread]="unreadCount > 0"
  >
    <div class="icon-inner">
      <svg
        *ngIf="!showChatPanel"
        viewBox="0 0 24 24"
        width="28"
        height="28"
        fill="currentColor"
      >
        <path
          d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"
        />
      </svg>

      <svg
        *ngIf="showChatPanel"
        viewBox="0 0 24 24"
        width="28"
        height="28"
        fill="currentColor"
      >
        <path d="M18 6L6 18M6 6l12 12" />
      </svg>
    </div>

    <!-- Unread Badge -->
    <div class="unread-badge" *ngIf="unreadCount > 0 && !showChatPanel">
      {{ unreadCount > 9 ? "9+" : unreadCount }}
    </div>

    <!-- Pulse Effect -->
    <div class="pulse-ring" *ngIf="unreadCount > 0 && !showChatPanel"></div>
  </div>
</div>
